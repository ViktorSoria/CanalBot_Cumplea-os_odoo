<?xml version="1.0" encoding="utf-8"?> 

<!--Modificacion de la vista de formulario de los proyectos-->
<odoo> 

	<!--Modificacion de la vista de busqueda -->
	<record id="view_task_search_form_inherit" model="ir.ui.view">
		<field name="name">project.task.inherited1</field>
		<field name="model">project.task</field>				<!-- especificacion del modulo del que vamos a heredar (MODEL)-->
		<field name="inherit_id" ref="project.view_task_search_form"/>
		<field name="arch" type="xml">
			<xpath expr="//filter[@name='my_tasks']" position="attributes">
				<attribute name="domain">['|',('user_id', '=', uid),('create_uid','=',uid)]</attribute>
			</xpath>
		</field>
	</record>	

	<!--Modificacion de la vista de lista de las tareas -->
	<record id="view_task_tree2_inherit" model="ir.ui.view">
		<field name="name">project.task.inherited2</field>
		<field name="model">project.task</field>
		<field name="inherit_id" ref="project.view_task_tree2"/>
		<field name="arch" type="xml">
			<xpath expr="//field[@name='project_id']" position="attributes">
				<attribute name="string">Area</attribute>
			</xpath>
		</field>
	</record>	


	<!-- Hace invisible el campo  sale_line_id-->
	<record id="view_sale_project_inherit_forminherit" model="ir.ui.view">
		<field name="name">project.task.inherited7</field>
		<field name="model">project.task</field>
		<field name="inherit_id" ref="sale_project.view_sale_project_inherit_form"/>
		<field name="arch" type="xml">
			<xpath expr="//field[@name='sale_line_id']" position="attributes">
				<attribute name="invisible">True</attribute>
			</xpath>
		</field>
	</record>	
	

	<record id="view_task_form2_inherit" model="ir.ui.view">
		<field name="name">project.task.inherited</field>
		<field name="model">project.task</field>				<!-- especificacion del modulo del que vamos a heredar (MODEL)-->
		<field name="inherit_id" ref="project.view_task_form2"/>
		<field name="arch" type="xml">

			<!-- Indica quien creo el nuevo registro-->
			<xpath expr="//field[@name='project_id']" position="before">
				<field name="create_uid"/>
				<field name="user_areas" invisible="True"/>	
				<field name="usuarios_filtrados" invisible="True"/>	
						
			</xpath>

			<xpath expr="//field[@name='user_id']" position="attributes">
				<attribute name="domain">[('id','in',usuarios_filtrados)]</attribute>
				<attribute name="required">True</attribute>
				<attribute name="default">False</attribute> <!--No funciona el default -->
			</xpath>

			<!-- Establece el dominio del project_id -->
			<xpath expr="//field[@name='project_id']" position="attributes">
				<attribute name="string">Area</attribute>
			</xpath>


			<!-- Oculto el campo del cliente-->
			<xpath expr="//field[@name='partner_id']" position="attributes"> 
     			<attribute name="invisible">True</attribute>
			</xpath>
		</field>
	</record>	


	<!-- Heredo la accion correspondiente a la vista del menu "Tickets" y cambio su dominio -->
	<record id="project.action_view_all_task" model="ir.actions.act_window">
		<field name="domain">['|','|',('create_uid','=',uid), ('user_id','=',uid), ('id','=',1)]</field>
	</record>	

	
	<!-- Al hacer clic en algun area, solo se mostraran los tickets asignados o creados por el usuario, a menos de que sea el administrador, en dado caso se muestran todos los tickets-->
	<record id="project.act_project_project_2_project_task_all" model="ir.actions.act_window">
		<field name="domain">['&amp;',('project_id', '=', active_id),'|',('create_uid','=',uid),'|',('user_id','=',uid), ('id','=',1)]</field>
	</record>	


	<!-- Hace que noupdate=False-->
	<function name="write" model="ir.model.data">
	    <function name="search" model="ir.model.data">
	        <value eval="[('module', '=', 'project'), ('name', '=', 'project_public_members_rule')]"/>
	    </function>
	    <value eval="{'noupdate': False}"/>
	</function>

	<!-- Modifica el dominio de la regla Project: Only invited users -->
	<record model="ir.rule" id="project.project_public_members_rule">
		<field name="domain_force">[
		'|',
			('id','in',user.User_Areas_ids.ids),('soporte','!=',user.soporte),
        '|',
            ('privacy_visibility', '!=', 'followers'),
            ('allowed_internal_user_ids', 'in', user.ids),
        ]</field>
	</record>
	
	<!-- Hace que noupdate=True-->
	<function name="write" model="ir.model.data">
	    <function name="search" model="ir.model.data">
	        <value eval="[('module', '=', 'project'), ('name', '=', 'project_public_members_rule')]"/>
	    </function>
	    <value eval="{'noupdate': True}"/>
	</function>


	<!-- Modifica el dominio del campo many2one del quick_create (al presionar el boton +)-->
	<record id="quick_create_task_form_inherit" model="ir.ui.view">
		<field name="name">project.task.inherited4</field>
		<field name="model">project.task</field>
		<field name="inherit_id" ref="project.quick_create_task_form"/>
		<field name="arch" type="xml">

			<xpath expr="//field[@name='name']" position="after">
				<field name="usuarios_filtrados" invisible="True"/>		
			</xpath>

			<xpath expr="//field[@name='user_id']" position="attributes">
				<attribute name="domain">[('id','in',usuarios_filtrados)]</attribute>
			</xpath>
		</field>
	</record>	


	<!-- Cambia el nombre de algunos campos en las vistas-->
	<record id="task_type_edit_inherit" model="ir.ui.view">
		<field name="name">project.task.type.inherited5</field>
		<field name="model">project.task.type</field>
		<field name="inherit_id" ref="project.task_type_edit"/>
		<field name="arch" type="xml">
			<xpath expr="//field[@name='project_ids']" position="attributes">
				<attribute name="string">Areas</attribute>
			</xpath>
		</field>
	</record>	


	<record id="task_type_tree_inherit" model="ir.ui.view">
		<field name="name">project.task.type.inherited6</field>
		<field name="model">project.task.type</field>
		<field name="inherit_id" ref="project.task_type_tree"/>
		<field name="arch" type="xml">
			<xpath expr="//field[@name='project_ids']" position="attributes">
				<attribute name="string">Areas</attribute>
			</xpath>
		</field>
	</record>	


	<!-- Añade el campo "soporte" (booleano) dentro de una nueva pagina en los usuarios-->
	<record id="view_users_form_inherit" model="ir.ui.view">
		<field name="name">res.users.inherited</field>
		<field name="model">res.users</field>	
		<field name="inherit_id" ref="base.view_users_form"/>
		<field name="arch" type="xml">
			<notebook position="inside"> <!-- Crea un nuevo notebook y añade un campo-->
				<page string="Soporte" name="soporte">
					<group>
						<field name="soporte"/>
						<field name="User_Areas_ids" widget="many2many_tags"/>
					</group>
				</page>
			</notebook>
		</field>
	</record>	
</odoo>